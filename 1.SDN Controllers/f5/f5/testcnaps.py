# -*- coding: utf-8 -*-
import SocketServer
import socket
import time
import sys
reload(sys)
print time.ctime()
sys.setdefaultencoding('utf-8')

class SMSsendx (object):
  def Sms(self):
     #.decode('utf-8').encode('gbk')
     host='10.4.145.65'
     port = 12916
     print 'host'+'->'+host
     print 'port'+'->'+str(port)

     bufsize=10240
     addr=(host,port)
     s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
     s.settimeout(20)
     s.connect((host,port))
     data=''
     # data='<?xml version="1.0" encoding="UTF-8"?><SERVICE><SYS_HEAD><USER_ID>007144</USER_ID><TRAN_TIMESTAMP>100443923</TRAN_TIMESTAMP><AUTH_USER_ID_ARRAY><AUTH_CHECK_FLAG></AUTH_CHECK_FLAG><AUTH_CHECK_MSG></AUTH_CHECK_MSG><AUTH_USER_ID></AUTH_USER_ID></AUTH_USER_ID_ARRAY><BRANCH_ID>330600600</BRANCH_ID><TRAN_DATE>20170920</TRAN_DATE><ORG_SYS_ID>101020</ORG_SYS_ID><SOURCE_TYPE>A01</SOURCE_TYPE><PROVIDER_ID>301020</PROVIDER_ID><CONSUMER_SEQ_NO>10102020170926010000550744</CONSUMER_SEQ_NO><WS_ID>10.4.129.21</WS_ID><SERVICE_SCENE>17</SERVICE_SCENE><SERVICE_CODE>01003000003</SERVICE_CODE><CONSUMER_ID>101020</CONSUMER_ID><FILE_PATH></FILE_PATH></SYS_HEAD><APP_HEAD><LKG_FLAG></LKG_FLAG><CURRENT_NUM>0</CURRENT_NUM><WNDW_NO>0</WNDW_NO><REVERSAL_DATE></REVERSAL_DATE><TOTAL_ROWS></TOTAL_ROWS><PSWD_KEY_INDX></PSWD_KEY_INDX><SEND_TRAN_CODE></SEND_TRAN_CODE><PSWD_ECPTN_FLG></PSWD_ECPTN_FLG><AHR_MODE></AHR_MODE><BUSS_SEQ_NO>10102020170926010000550744</BUSS_SEQ_NO><WARN_CFM_FLAG></WARN_CFM_FLAG><CORP_CODE>9999</CORP_CODE><TOTAL_NUM>14</TOTAL_NUM><FEE_CFM_FLAG></FEE_CFM_FLAG><LKG_TRAN_CODE></LKG_TRAN_CODE><SEND_TRAN_NAME></SEND_TRAN_NAME><TRAN_SCENE>0000000000</TRAN_SCENE><PGUP_OR_PGDN></PGUP_OR_PGDN><CHNL_FLG_STRG>10000000000000000000</CHNL_FLG_STRG><REVERSAL_SEQ_NO></REVERSAL_SEQ_NO><REVERSAL_TRAN_TYPE></REVERSAL_TRAN_TYPE></APP_HEAD><LOCAL_HEAD></LOCAL_HEAD><BODY><CURRENT_NUM>0</CURRENT_NUM><ACCT_NO>33010000201000000459</ACCT_NO><PASSWORD_TYPE>0</PASSWORD_TYPE><START_PAGE>1</START_PAGE><TOTAL_NUM>14</TOTAL_NUM><ACCT_SERIAL_NO></ACCT_SERIAL_NO><RET_CERT_SBU_ACCT_DETAIL_FLG>1</RET_CERT_SBU_ACCT_DETAIL_FLG><SVC_FIELD>0110111100</SVC_FIELD></BODY></SERVICE>'
     # length = len(data.encode('utf-8'))
     # slen = '%08d' % length
     # data=slen + data
     # data='000314<?xml version="1.0" encoding="UTF-8"?> <Esb> <head> <Serial>21801020180528010000218475</Serial> <Channel>L06</Channel> <DateTime>2018052810241220</DateTime> <HostCode>ES999</HostCode> <TermNo>APP</TermNo> <TxnUsr>ZXGY</TxnUsr> <TxnOrg>999999999</TxnOrg> <CONSUMER_ID>218010</CONSUMER_ID> </head> </Esb>'
     data='<?xml version="1.0" encoding="UTF-8"?> <SERVICE> <SYS_HEAD> <TRAN_DATE>20190101</TRAN_DATE> <TRAN_TIMESTAMP>010101001</TRAN_TIMESTAMP> <BRANCH_ID>999999999</BRANCH_ID> <CONSUMER_ID>408090</CONSUMER_ID> <USER_ID>Z888</USER_ID> <SERVICE_SCENE>01</SERVICE_SCENE> <SERVICE_CODE>99993000001</SERVICE_CODE> <CONSUMER_SEQ_NO>99993000001010000000000025</CONSUMER_SEQ_NO> </SYS_HEAD> <APP_HEAD> <BUSS_SEQ_NO>99993000001010000000000025</BUSS_SEQ_NO> </APP_HEAD> <LOCAL_HEAD/> <BODY/> </SERVICE>' 
     length = len(data.encode('utf-8'))
     slen = '%08d' % length
     data=slen + data
     print data 
     msg = data.encode('gbk') 
     s.send(data)
     data = s.recv(bufsize) 
     cur_time = time.strftime("%Y-%m-%d %H:%M:%S", time.localtime())
     print ("%s receice from server :%s") % (cur_time,data)
     s.close()
a=SMSsendx()
a.Sms()
print time.ctime()
